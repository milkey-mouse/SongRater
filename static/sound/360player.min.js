var threeSixtyPlayer,ThreeSixtyPlayer;(function(e){function t(){var t=this,n=this,r=soundManager,i=navigator.userAgent,s=i.match(/msie/i),o=i.match(/opera/i),u=i.match(/safari/i),a=i.match(/chrome/i),f=i.match(/firefox/i),l=i.match(/ipad|iphone/i),c=typeof e.G_vmlCanvasManager==="undefined"&&typeof document.createElement("canvas").getContext("2d")!=="undefined",h=o||a?359.9:360,p=navigator.userAgent.match(/msie [678]/i)?1:2;this.excludeClass="threesixty-exclude";this.links=[];this.sounds=[];this.soundsByURL=[];this.indexByURL=[];this.lastSound=null;this.lastTouchedSound=null;this.soundCount=0;this.oUITemplate=null;this.oUIImageMap=null;this.vuMeter=null;this.callbackCount=0;this.peakDataHistory=[];this.config={playNext:false,autoPlay:true,allowMultiple:false,loadRingColor:"#ccc",playRingColor:"#FF0000",backgroundRingColor:"#eee",circleDiameter:256,circleRadius:128,animDuration:500,animTransition:Animator.tx.bouncy,showHMSTime:true,useWaveformData:true,waveformDataColor:"#000000",waveformDataDownsample:1,waveformDataOutside:true,waveformDataConstrain:false,waveformDataLineRatio:.34,useEQData:true,eqDataColor:"#000000",eqDataDownsample:12,eqDataOutside:false,eqDataLineRatio:.63,usePeakData:true,peakDataColor:"#ff33ff",peakDataOutside:true,peakDataLineRatio:.5,useAmplifier:true};this.css={sDefault:"sm2_link",sBuffering:"sm2_buffering",sPlaying:"sm2_playing",sPaused:"sm2_paused"};this.addEventHandler=typeof e.addEventListener!=="undefined"?function(e,t,n){return e.addEventListener(t,n,false)}:function(e,t,n){e.attachEvent("on"+t,n)};this.removeEventHandler=typeof e.removeEventListener!=="undefined"?function(e,t,n){return e.removeEventListener(t,n,false)}:function(e,t,n){return e.detachEvent("on"+t,n)};this.hasClass=function(e,t){return typeof e.className!=="undefined"?e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)")):false};this.addClass=function(e,n){if(!e||!n||t.hasClass(e,n)){return false}e.className=(e.className?e.className+" ":"")+n};this.removeClass=function(e,n){if(!e||!n||!t.hasClass(e,n)){return false}e.className=e.className.replace(new RegExp("( "+n+")|("+n+")","g"),"")};this.getElementsByClassName=function(e,n,r){var i=r||document,s=[],o,u,a=[];if(typeof n!=="undefined"&&typeof n!=="string"){for(o=n.length;o--;){if(!a||!a[n[o]]){a[n[o]]=i.getElementsByTagName(n[o])}}}else if(n){a=i.getElementsByTagName(n)}else{a=i.all||i.getElementsByTagName("*")}if(typeof n!=="string"){for(o=n.length;o--;){for(u=a[n[o]].length;u--;){if(t.hasClass(a[n[o]][u],e)){s.push(a[n[o]][u])}}}}else{for(o=0;o<a.length;o++){if(t.hasClass(a[o],e)){s.push(a[o])}}}return s};this.getParentByNodeName=function(e,t){if(!e||!t){return false}t=t.toLowerCase();while(e.parentNode&&t!==e.parentNode.nodeName.toLowerCase()){e=e.parentNode}return e.parentNode&&t===e.parentNode.nodeName.toLowerCase()?e.parentNode:null};this.getParentByClassName=function(e,n){if(!e||!n){return false}while(e.parentNode&&!t.hasClass(e.parentNode,n)){e=e.parentNode}return e.parentNode&&t.hasClass(e.parentNode,n)?e.parentNode:null};this.getSoundByURL=function(e){return typeof t.soundsByURL[e]!=="undefined"?t.soundsByURL[e]:null};this.isChildOfNode=function(e,t){if(!e||!e.parentNode){return false}t=t.toLowerCase();do{e=e.parentNode}while(e&&e.parentNode&&e.nodeName.toLowerCase()!==t);return e&&e.nodeName.toLowerCase()===t?e:null};this.isChildOfClass=function(e,n){if(!e||!n){return false}while(e.parentNode&&!t.hasClass(e,n)){e=t.findParent(e)}return t.hasClass(e,n)};this.findParent=function(e){if(!e||!e.parentNode){return false}e=e.parentNode;if(e.nodeType===2){while(e&&e.parentNode&&e.parentNode.nodeType===2){e=e.parentNode}}return e};this.getStyle=function(t,n){try{if(t.currentStyle){return t.currentStyle[n]}else if(e.getComputedStyle){return document.defaultView.getComputedStyle(t,null).getPropertyValue(n)}}catch(r){}return null};this.findXY=function(e){var t=0,n=0;do{t+=e.offsetLeft;n+=e.offsetTop}while(!!(e=e.offsetParent));return[t,n]};this.getMouseXY=function(n){n=n?n:e.event;if(l&&n.touches){n=n.touches[0]}if(n.pageX||n.pageY){return[n.pageX,n.pageY]}else if(n.clientX||n.clientY){return[n.clientX+t.getScrollLeft(),n.clientY+t.getScrollTop()]}};this.getScrollLeft=function(){return document.body.scrollLeft+document.documentElement.scrollLeft};this.getScrollTop=function(){return document.body.scrollTop+document.documentElement.scrollTop};this.events={play:function(){n.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className=n.css.sPlaying;n.addClass(this._360data.oUIBox,this._360data.className);t.fanOut(this)},stop:function(){n.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className="";t.fanIn(this)},pause:function(){n.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className=n.css.sPaused;n.addClass(this._360data.oUIBox,this._360data.className)},resume:function(){n.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className=n.css.sPlaying;n.addClass(this._360data.oUIBox,this._360data.className)},finish:function(){var e;n.removeClass(this._360data.oUIBox,this._360data.className);this._360data.className="";this._360data.didFinish=true;t.fanIn(this);if(n.config.playNext){e=n.indexByURL[this._360data.oLink.href]+1;if(e<n.links.length){n.handleClick({target:n.links[e]})}}},whileloading:function(){if(this.paused){t.updatePlaying.apply(this)}},whileplaying:function(){t.updatePlaying.apply(this);this._360data.fps++},bufferchange:function(){if(this.isBuffering){n.addClass(this._360data.oUIBox,n.css.sBuffering)}else{n.removeClass(this._360data.oUIBox,n.css.sBuffering)}}};this.stopEvent=function(t){if(typeof t!=="undefined"&&typeof t.preventDefault!=="undefined"){t.preventDefault()}else if(typeof e.event!=="undefined"&&typeof e.event.returnValue!=="undefined"){e.event.returnValue=false}return false};this.getTheDamnLink=s?function(t){return t&&t.target?t.target:e.event.srcElement}:function(e){return e.target};this.handleClick=function(n){if(n.button>1){return true}var i=t.getTheDamnLink(n),s,o,u,a,f,l,c;if(i.nodeName.toLowerCase()!=="a"){i=t.isChildOfNode(i,"a");if(!i){return true}}if(!t.isChildOfClass(i,"ui360")){return true}o=i.getAttribute("href");if(!i.href||!r.canPlayLink(i)||t.hasClass(i,t.excludeClass)){return true}r._writeDebug("handleClick()");u=i.href;a=t.getSoundByURL(u);if(a){if(a===t.lastSound){a.togglePause()}else{a.togglePause();r._writeDebug("sound different than last sound: "+t.lastSound.id);if(!t.config.allowMultiple&&t.lastSound){t.stopSound(t.lastSound)}}}else{f=i.parentNode;l=t.getElementsByClassName("ui360-vis","div",f.parentNode).length;a=r.createSound({id:"ui360Sound"+t.soundCount++,url:u,onplay:t.events.play,onstop:t.events.stop,onpause:t.events.pause,onresume:t.events.resume,onfinish:t.events.finish,onbufferchange:t.events.bufferchange,type:i.type||null,whileloading:t.events.whileloading,whileplaying:t.events.whileplaying,useWaveformData:l&&t.config.useWaveformData,useEQData:l&&t.config.useEQData,usePeakData:l&&t.config.usePeakData});c=parseInt(t.getElementsByClassName("sm2-360ui","div",f)[0].offsetWidth*p,10);s=t.getElementsByClassName("sm2-canvas","canvas",f),a._360data={oUI360:t.getParentByClassName(i,"ui360"),oLink:i,className:t.css.sPlaying,oUIBox:t.getElementsByClassName("sm2-360ui","div",f)[0],oCanvas:s[s.length-1],oButton:t.getElementsByClassName("sm2-360btn","span",f)[0],oTiming:t.getElementsByClassName("sm2-timing","div",f)[0],oCover:t.getElementsByClassName("sm2-cover","div",f)[0],circleDiameter:c,circleRadius:c/2,lastTime:null,didFinish:null,pauseCount:0,radius:0,fontSize:1,fontSizeMax:t.config.fontSizeMax,scaleFont:l&&t.config.scaleFont,showHMSTime:l,amplifier:l&&t.config.usePeakData?.9:1,radiusMax:c*.175,width:.2,widthMax:c*.4,lastValues:{bytesLoaded:0,bytesTotal:0,position:0,durationEstimate:0},animating:false,oAnim:new e.Animator({duration:t.config.animDuration,transition:t.config.animTransition,onComplete:function(){}}),oAnimProgress:function(e){var n=this;n._360data.radius=parseInt(n._360data.radiusMax*n._360data.amplifier*e,10);n._360data.width=parseInt(n._360data.widthMax*n._360data.amplifier*e,10);if(n._360data.scaleFont&&n._360data.fontSizeMax!==null){n._360data.oTiming.style.fontSize=parseInt(Math.max(1,n._360data.fontSizeMax*e),10)+"px";n._360data.oTiming.style.opacity=e}if(n.paused||n.playState===0||n._360data.lastValues.bytesLoaded===0||n._360data.lastValues.position===0){t.updatePlaying.apply(n)}},fps:0};if(typeof t.Metadata!=="undefined"&&t.getElementsByClassName("metadata","div",a._360data.oUI360).length){a._360data.metadata=new t.Metadata(a,t)}if(a._360data.scaleFont&&a._360data.fontSizeMax!==null){a._360data.oTiming.style.fontSize="1px"}a._360data.oAnim.addSubject(a._360data.oAnimProgress,a);t.refreshCoords(a);t.updatePlaying.apply(a);t.soundsByURL[u]=a;t.sounds.push(a);if(!t.config.allowMultiple&&t.lastSound){t.stopSound(t.lastSound)}a.play()}t.lastSound=a;if(typeof n!=="undefined"&&typeof n.preventDefault!=="undefined"){n.preventDefault()}else if(typeof e.event!=="undefined"){e.event.returnValue=false}return false};this.fanOut=function(n){var r=n;if(r._360data.animating===1){return false}r._360data.animating=0;soundManager._writeDebug("fanOut: "+r.id+": "+r._360data.oLink.href);r._360data.oAnim.seekTo(1);e.setTimeout(function(){r._360data.animating=0},t.config.animDuration+20)};this.fanIn=function(n){var r=n;if(r._360data.animating===-1){return false}r._360data.animating=-1;soundManager._writeDebug("fanIn: "+r.id+": "+r._360data.oLink.href);r._360data.oAnim.seekTo(0);e.setTimeout(function(){r._360data.didFinish=false;r._360data.animating=0;t.resetLastValues(r)},t.config.animDuration+20)};this.resetLastValues=function(e){e._360data.lastValues.position=0};this.refreshCoords=function(e){e._360data.canvasXY=t.findXY(e._360data.oCanvas);e._360data.canvasMid=[e._360data.circleRadius,e._360data.circleRadius];e._360data.canvasMidXY=[e._360data.canvasXY[0]+e._360data.canvasMid[0],e._360data.canvasXY[1]+e._360data.canvasMid[1]]};this.stopSound=function(e){soundManager._writeDebug("stopSound: "+e.id);soundManager.stop(e.id);if(!l){soundManager.unload(e.id)}};this.buttonClick=function(n){var r=n?n.target?n.target:n.srcElement:e.event.srcElement;t.handleClick({target:t.getParentByClassName(r,"sm2-360ui").nextSibling});return false};this.buttonMouseDown=function(e){if(!l){document.onmousemove=function(e){t.mouseDown(e)}}else{t.addEventHandler(document,"touchmove",t.mouseDown)}t.stopEvent(e);return false};this.mouseDown=function(n){if(!l&&n.button>1){return true}if(!t.lastSound){t.stopEvent(n);return false}var r=n?n:e.event,i,s,o;if(l&&r.touches){r=r.touches[0]}i=r.target||r.srcElement;s=t.getSoundByURL(t.getElementsByClassName("sm2_link","a",t.getParentByClassName(i,"ui360"))[0].href);t.lastTouchedSound=s;t.refreshCoords(s);o=s._360data;t.addClass(o.oUIBox,"sm2_dragging");o.pauseCount=t.lastTouchedSound.paused?1:0;t.mmh(n?n:e.event);if(l){t.removeEventHandler(document,"touchmove",t.mouseDown);t.addEventHandler(document,"touchmove",t.mmh);t.addEventHandler(document,"touchend",t.mouseUp)}else{document.onmousemove=t.mmh;document.onmouseup=t.mouseUp}t.stopEvent(n);return false};this.mouseUp=function(e){var n=t.lastTouchedSound._360data;t.removeClass(n.oUIBox,"sm2_dragging");if(n.pauseCount===0){t.lastTouchedSound.resume()}if(!l){document.onmousemove=null;document.onmouseup=null}else{t.removeEventHandler(document,"touchmove",t.mmh);t.removeEventHandler(document,"touchend",t.mouseUP)}};this.mmh=function(e){return false};this.drawSolidArc=function(e,n,r,i,s,a,f){var l=r,c=r,h=e,p,d,v,m;if(h.getContext){p=h.getContext("2d")}e=p;if(!f){t.clearCanvas(h)}if(n){p.fillStyle=n}e.beginPath();if(isNaN(s)){s=0}d=r-i;v=o||u;if(!v||v&&r>0){e.arc(0,0,r,a,s,false);m=t.getArcEndpointCoords(d,s);e.lineTo(m.x,m.y);e.arc(0,0,d,s,a,true);e.closePath();e.fill()}};this.getArcEndpointCoords=function(e,t){return{x:e*Math.cos(t),y:e*Math.sin(t)}};this.deg2rad=function(e){return e*Math.PI/180};this.rad2deg=function(e){return e*180/Math.PI};this.getTime=function(e,t){var n=Math.floor(e/1e3),r=Math.floor(n/60),i=n-r*60;return t?r+":"+(i<10?"0"+i:i):{min:r,sec:i}};this.clearCanvas=function(e){var t=e,n=null,r,i;if(t.getContext){n=t.getContext("2d")}if(n){r=t.offsetWidth;i=t.offsetHeight;n.clearRect(-(r/2),-(i/2),r,i)}};this.updatePlaying=function(){var e=this._360data.showHMSTime?t.getTime(this.position,true):parseInt(this.position/1e3,10);var n=t.config.scaleArcWidth;if(this.bytesLoaded){this._360data.lastValues.bytesLoaded=this.bytesLoaded;this._360data.lastValues.bytesTotal=this.bytesTotal}if(this.position){this._360data.lastValues.position=this.position}if(this.durationEstimate){this._360data.lastValues.durationEstimate=this.durationEstimate}t.drawSolidArc(this._360data.oCanvas,t.config.backgroundRingColor,this._360data.width,this._360data.radius*n,t.deg2rad(h),false);t.drawSolidArc(this._360data.oCanvas,this._360data.metadata?t.config.loadRingColorMetadata:t.config.loadRingColor,this._360data.width,this._360data.radius*n,t.deg2rad(360),0,true);if(this._360data.lastValues.position!==0){t.drawSolidArc(this._360data.oCanvas,this._360data.metadata?t.config.playRingColorMetadata:t.config.playRingColor,185,48,t.deg2rad(this._360data.didFinish===1?h:h*(this._360data.lastValues.position/this._360data.lastValues.durationEstimate)),0,true)}if(this._360data.metadata){this._360data.metadata.events.whileplaying()}if(e!==this._360data.lastTime){this._360data.lastTime=e;this._360data.oTiming.innerHTML=e}if((this.instanceOptions.useWaveformData||this.instanceOptions.useEQData)&&c){t.updateWaveform(this)}if(t.config.useFavIcon&&t.vuMeter){t.vuMeter.updateVU(this)}};this.updateWaveform=function(e){if(!t.config.useWaveformData&&!t.config.useEQData||!r.features.waveformData&&!r.features.eqData){return false}if(!e.waveformData.left.length&&!e.eqData.length&&!e.peakData.left){return false}var n=e._360data.oCanvas.getContext("2d"),i=0,s=parseInt(e._360data.circleDiameter/2,10),o=s/2,u=1,a=1,f=0,l=s,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;if(t.config.useWaveformData){d=t.config.waveformDataDownsample;d=Math.max(1,d);v=256;m=v/d;g=0;y=0;b=null;w=t.config.waveformDataOutside?1:t.config.waveformDataConstrain?.5:.565;o=t.config.waveformDataOutside?.7:.75;E=t.deg2rad(360/m*t.config.waveformDataLineRatio);for(c=0;c<v;c+=d){g=t.deg2rad(360*(c/m*1/d));y=g+E;b=e.waveformData.left[c];if(b<0&&t.config.waveformDataConstrain){b=Math.abs(b)}}}if(t.config.useEQData){d=t.config.eqDataDownsample;S=0;d=Math.max(1,d);x=192;m=x/d;w=t.config.eqDataOutside?1:.565;p=t.config.eqDataOutside?-1:1;o=t.config.eqDataOutside?.5:.75;g=0;y=0;E=t.deg2rad(360/m*t.config.eqDataLineRatio);T=t.deg2rad(e._360data.didFinish===1?360:360*(e._360data.lastValues.position/e._360data.lastValues.durationEstimate));h=0;N=0;for(c=0;c<x;c+=d){g=t.deg2rad(360*(c/x));y=g+E}}if(t.config.usePeakData){if(!e._360data.animating){C=e.peakData.left||e.peakData.right;x=3;for(c=0;c<x;c++){C=C||e.eqData[c]}e._360data.amplifier=t.config.useAmplifier?.9+C*.1:1;e._360data.radiusMax=e._360data.circleDiameter*.175*e._360data.amplifier;e._360data.widthMax=e._360data.circleDiameter*.4*e._360data.amplifier;e._360data.radius=parseInt(e._360data.radiusMax*e._360data.amplifier,10);e._360data.width=parseInt(e._360data.widthMax*e._360data.amplifier,10)}}};this.getUIHTML=function(e){return['<canvas class="sm2-canvas" width="'+e+'" height="'+e+'"></canvas>',' <span class="sm2-360btn sm2-360btn-default"></span>',' <div class="sm2-timing'+(navigator.userAgent.match(/safari/i)?" alignTweak":"")+'"></div>',' <div class="sm2-cover"></div>']};this.uiTest=function(e){var n=document.createElement("div"),r,i,s,o,u,a,f,l,c;n.className="sm2-360ui";r=document.createElement("div");r.className="ui360"+(e?" "+e:"");i=r.appendChild(n.cloneNode(true));r.style.position="absolute";r.style.left="-9999px";s=document.body.appendChild(r);o=i.offsetWidth*p;u=t.getUIHTML(o);i.innerHTML=u[1]+u[2]+u[3];a=parseInt(o,10);f=parseInt(a/2,10);c=t.getElementsByClassName("sm2-timing","div",s)[0];l=parseInt(t.getStyle(c,"font-size"),10);if(isNaN(l)){l=null}r.parentNode.removeChild(r);u=r=i=s=null;return{circleDiameter:a,circleRadius:f,fontSizeMax:l}};this.init=function(){r._writeDebug("threeSixtyPlayer.init()");var n=t.getElementsByClassName("ui360","div"),i,o,u=[],a=false,f=0,c,h,d,v,m,g,y,b,w,E,S,x,T;for(i=0,o=n.length;i<o;i++){u.push(n[i].getElementsByTagName("a")[0]);n[i].style.backgroundImage="none"}t.oUITemplate=document.createElement("div");t.oUITemplate.className="sm2-360ui";t.oUITemplateVis=document.createElement("div");t.oUITemplateVis.className="sm2-360ui";y=t.uiTest();t.config.circleDiameter=y.circleDiameter;t.config.circleRadius=y.circleRadius;b=t.uiTest("ui360-vis");t.config.fontSizeMax=b.fontSizeMax;t.oUITemplate.innerHTML=t.getUIHTML(t.config.circleDiameter).join("");t.oUITemplateVis.innerHTML=t.getUIHTML(b.circleDiameter).join("");for(i=0,o=u.length;i<o;i++){if(r.canPlayLink(u[i])&&!t.hasClass(u[i],t.excludeClass)&&!t.hasClass(u[i],t.css.sDefault)){t.addClass(u[i],t.css.sDefault);t.links[f]=u[i];t.indexByURL[u[i].href]=f;f++;a=t.hasClass(u[i].parentNode,"ui360-vis");m=(a?b:y).circleDiameter;g=(a?b:y).circleRadius;w=u[i].parentNode.insertBefore((a?t.oUITemplateVis:t.oUITemplate).cloneNode(true),u[i]);if(s&&typeof e.G_vmlCanvasManager!=="undefined"){S=u[i].parentNode;x=document.createElement("canvas");x.className="sm2-canvas";T="sm2_canvas_"+i+(new Date).getTime();x.id=T;x.width=m;x.height=m;w.appendChild(x);e.G_vmlCanvasManager.initElement(x);h=document.getElementById(T);c=h.parentNode.getElementsByTagName("canvas");if(c.length>1){h=c[c.length-1]}}else{h=u[i].parentNode.getElementsByTagName("canvas")[0]}if(p>1){t.addClass(h,"hi-dpi")}v=t.getElementsByClassName("sm2-cover","div",u[i].parentNode)[0];E=u[i].parentNode.getElementsByTagName("span")[0];t.addEventHandler(E,"click",t.buttonClick);if(!l){t.addEventHandler(v,"mousedown",t.mouseDown)}else{t.addEventHandler(v,"touchstart",t.mouseDown)}d=h.getContext("2d");d.translate(g,g);d.rotate(t.deg2rad(-90))}}if(f>0){t.addEventHandler(document,"click",t.handleClick);if(t.config.autoPlay){t.handleClick({target:t.links[0],preventDefault:function(){}})}}r._writeDebug("threeSixtyPlayer.init(): Found "+f+" relevant items.");if(t.config.useFavIcon&&typeof this.VUMeter!=="undefined"){this.vuMeter=new this.VUMeter(this)}}}t.prototype.VUMeter=function(e){var t=e,n=this,r=document.getElementsByTagName("head")[0],i=navigator.userAgent.match(/opera/i),s=navigator.userAgent.match(/firefox/i);this.vuMeterData=[];this.vuDataCanvas=null;this.setPageIcon=function(e){if(!t.config.useFavIcon||!t.config.usePeakData||!e){return false}var n=document.getElementById("sm2-favicon");if(n){r.removeChild(n);n=null}if(!n){n=document.createElement("link");n.id="sm2-favicon";n.rel="shortcut icon";n.type="image/png";n.href=e;document.getElementsByTagName("head")[0].appendChild(n)}};this.resetPageIcon=function(){if(!t.config.useFavIcon){return false}var e=document.getElementById("favicon");if(e){e.href="/favicon.ico"}};this.updateVU=function(e){if(soundManager.flashVersion>=9&&t.config.useFavIcon&&t.config.usePeakData){n.setPageIcon(n.vuMeterData[parseInt(16*e.peakData.left,10)][parseInt(16*e.peakData.right,10)])}};this.createVUData=function(){var e=0,t=0,r=n.vuDataCanvas.getContext("2d"),i=r.createLinearGradient(0,16,0,0),s=r.createLinearGradient(0,16,0,0),o="rgba(0,0,0,0.2)";i.addColorStop(0,"rgb(0,192,0)");i.addColorStop(.3,"rgb(0,255,0)");i.addColorStop(.625,"rgb(255,255,0)");i.addColorStop(.85,"rgb(255,0,0)");s.addColorStop(0,o);s.addColorStop(1,"rgba(0,0,0,0.5)");for(e=0;e<16;e++){n.vuMeterData[e]=[]}for(e=0;e<16;e++){for(t=0;t<16;t++){n.vuDataCanvas.setAttribute("width",16);n.vuDataCanvas.setAttribute("height",16);r.fillStyle=s;r.fillRect(0,0,7,15);r.fillRect(8,0,7,15);r.fillStyle=i;r.fillRect(0,15-e,7,16-(16-e));r.fillRect(8,15-t,7,16-(16-t));r.clearRect(0,3,16,1);r.clearRect(0,7,16,1);r.clearRect(0,11,16,1);n.vuMeterData[e][t]=n.vuDataCanvas.toDataURL("image/png")}}};this.testCanvas=function(){var e=document.createElement("canvas"),t=null,n;if(!e||typeof e.getContext==="undefined"){return null}t=e.getContext("2d");if(!t||typeof e.toDataURL!=="function"){return null}try{n=e.toDataURL("image/png")}catch(r){return null}return e};this.init=function(){if(t.config.useFavIcon){n.vuDataCanvas=n.testCanvas();if(n.vuDataCanvas&&(s||i)){n.createVUData()}else{t.config.useFavIcon=false}}};this.init()};t.prototype.Metadata=function(e,t){soundManager._wD("Metadata()");var n=this,r=e._360data.oUI360,i=r.getElementsByTagName("ul")[0],s=i.getElementsByTagName("li"),o=navigator.userAgent.match(/firefox/i),u=false,a,f;this.lastWPExec=0;this.refreshInterval=250;this.totalTime=0;this.events={whileplaying:function(){var r=e._360data.width,i=e._360data.radius,s=e.durationEstimate||n.totalTime*1e3,o=null,u,a,f;for(u=0,a=n.data.length;u<a;u++){o=u%2===0;t.drawSolidArc(e._360data.oCanvas,o?t.config.segmentRingColorAlt:t.config.segmentRingColor,o?r:r,o?i/2:i/2,t.deg2rad(360*(n.data[u].endTimeMS/s)),t.deg2rad(360*((n.data[u].startTimeMS||1)/s)),true)}f=new Date;if(f-n.lastWPExec>n.refreshInterval){n.refresh();n.lastWPExec=f}}};this.refresh=function(){var t,n,r=null,i=e.position,s=e._360data.metadata.data;for(t=0,n=s.length;t<n;t++){if(i>=s[t].startTimeMS&&i<=s[t].endTimeMS){r=t;break}}if(r!==s.currentItem&&r<s.length){e._360data.oLink.innerHTML=s.mainTitle+' <span class="metadata"><span class="sm2_divider"> | </span><span class="sm2_metadata">'+s[r].title+"</span></span>";s.currentItem=r}};this.strToTime=function(e){var t=e.split(":"),n=0,r;for(r=t.length;r--;){n+=parseInt(t[r],10)*Math.pow(60,t.length-1-r)}return n};this.data=[];this.data.givenDuration=null;this.data.currentItem=null;this.data.mainTitle=e._360data.oLink.innerHTML;for(a=0;a<s.length;a++){this.data[a]={o:null,title:s[a].getElementsByTagName("p")[0].innerHTML,startTime:s[a].getElementsByTagName("span")[0].innerHTML,startSeconds:n.strToTime(s[a].getElementsByTagName("span")[0].innerHTML.replace(/[()]/g,"")),duration:0,durationMS:null,startTimeMS:null,endTimeMS:null,oNote:null}}f=t.getElementsByClassName("duration","div",r);this.data.givenDuration=f.length?n.strToTime(f[0].innerHTML)*1e3:0;for(a=0;a<this.data.length;a++){this.data[a].duration=parseInt(this.data[a+1]?this.data[a+1].startSeconds:(n.data.givenDuration?n.data.givenDuration:e.durationEstimate)/1e3,10)-this.data[a].startSeconds;this.data[a].startTimeMS=this.data[a].startSeconds*1e3;this.data[a].durationMS=this.data[a].duration*1e3;this.data[a].endTimeMS=this.data[a].startTimeMS+this.data[a].durationMS;this.totalTime+=this.data[a].duration}};if(navigator.userAgent.match(/webkit/i)&&navigator.userAgent.match(/mobile/i)){soundManager.setup({useHTML5Audio:true})}soundManager.setup({html5PollingInterval:50,debugMode:e.location.href.match(/debug=1/i),consoleOnly:true,flashVersion:9,useHighPerformance:true});if(soundManager.debugMode){e.setInterval(function(){var t=e.threeSixtyPlayer;if(t&&t.lastSound&&t.lastSound._360data.fps&&typeof e.isHome==="undefined"){soundManager._writeDebug("fps: ~"+t.lastSound._360data.fps);t.lastSound._360data.fps=0}},1e3)}e.ThreeSixtyPlayer=t})(window);threeSixtyPlayer=new ThreeSixtyPlayer;soundManager.onready(threeSixtyPlayer.init)